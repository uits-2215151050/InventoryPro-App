{% extends 'base.html.twig' %}

{% block title %}{{ 'admin.title'|trans }} - {{ parent() }}{% endblock %}

{% block body %}
<h3 class="mb-4">
    <i class="bi bi-shield-lock me-2"></i>{{ 'admin.users'|trans }}
</h3>

<div class="card">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th><input type="checkbox" class="form-check-input" id="selectAll"></th>
                        <th>User</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Status</th>
                        <th>Joined</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr>
                        <td><input type="checkbox" class="form-check-input user-checkbox" value="{{ user.id }}"></td>
                        <td>
                            <div class="d-flex align-items-center">
                                <img src="{{ user.avatarUrl ?? 'https://via.placeholder.com/32' }}" 
                                     class="rounded-circle me-2" width="32" height="32" alt="">
                                {{ user.name ?? '-' }}
                            </div>
                        </td>
                        <td>{{ user.email }}</td>
                        <td>
                            {% if user.isAdmin %}
                            <span class="badge bg-danger">Admin</span>
                            {% else %}
                            <span class="badge bg-secondary">User</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if user.isBlocked %}
                            <span class="badge bg-warning text-dark">Blocked</span>
                            {% else %}
                            <span class="badge bg-success">Active</span>
                            {% endif %}
                        </td>
                        <td>{{ user.createdAt|date('Y-m-d') }}</td>
                        <td>
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                                    <i class="bi bi-three-dots"></i>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li>
                                        <form action="{{ path('admin_user_block', {id: user.id}) }}" method="POST" class="d-inline">
                                            <button type="submit" class="dropdown-item">
                                                {% if user.isBlocked %}
                                                <i class="bi bi-unlock me-2"></i>{{ 'admin.unblock'|trans }}
                                                {% else %}
                                                <i class="bi bi-lock me-2"></i>{{ 'admin.block'|trans }}
                                                {% endif %}
                                            </button>
                                        </form>
                                    </li>
                                    <li>
                                        <form action="{{ path('admin_user_toggle_admin', {id: user.id}) }}" method="POST" class="d-inline">
                                            <button type="submit" class="dropdown-item">
                                                {% if user.isAdmin %}
                                                <i class="bi bi-person-dash me-2"></i>{{ 'admin.remove_admin'|trans }}
                                                {% else %}
                                                <i class="bi bi-person-plus me-2"></i>{{ 'admin.make_admin'|trans }}
                                                {% endif %}
                                            </button>
                                        </form>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <form action="{{ path('admin_user_delete', {id: user.id}) }}" method="POST" 
                                              onsubmit="return confirm('{{ 'admin.confirm_delete'|trans }}')">
                                            <button type="submit" class="dropdown-item text-danger">
                                                <i class="bi bi-trash me-2"></i>{{ 'admin.delete'|trans }}
                                            </button>
                                        </form>
                                    </li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
document.getElementById('selectAll')?.addEventListener('change', function() {
    document.querySelectorAll('.user-checkbox').forEach(cb => cb.checked = this.checked);
});
</script>
{% endblock %}
